create table public.canvas_design (
  id uuid not null default extensions.uuid_generate_v4 (),
  user_id uuid not null,
  poem_id uuid not null,
  title text null,
  background_url text null,
  created_at timestamp with time zone null default now(),
  updated_at timestamp with time zone null default now(),
  is_public boolean null default false,
  design_settings jsonb not null,
  thumbnail_url text null,
  copyrighted boolean null default false,
  is_witte_gevel boolean null default false,
  share_token uuid null,
  share_token_expires_at timestamp with time zone null,
  constraint canvas_designs_pkey primary key (id),
  constraint canvas_designs_poem_id_fkey foreign KEY (poem_id) references poem (id) on delete CASCADE,
  constraint canvas_designs_user_id_fkey foreign KEY (user_id) references profile (id) on delete CASCADE,
  constraint fk_design_poem foreign KEY (poem_id) references poem (id)
) TABLESPACE pg_default;

create trigger canvas_design_updated_at_trigger BEFORE
update on canvas_design for EACH row
execute FUNCTION update_updated_at ();

create trigger design_activity_trigger
after INSERT on canvas_design for EACH row
execute FUNCTION track_user_activity ();

create trigger design_cascade_delete_trigger BEFORE DELETE on canvas_design for EACH row
execute FUNCTION handle_cascade_deletes ();

create trigger design_poem_flags_trigger
after INSERT
or DELETE on canvas_design for EACH row
execute FUNCTION update_poem_flags ();

create trigger set_timestamp_canvas_designs BEFORE
update on canvas_design for EACH row
execute FUNCTION trigger_set_timestamp ();